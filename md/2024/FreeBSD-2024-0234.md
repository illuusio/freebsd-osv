# FreeBSD -- pf incorrectly matches different ICMPv6 states in the state table
# Problem Description:

In ICMPv6 Neighbor Discovery (ND), the ID is always 0. When pf is
configured to allow ND and block incoming Echo Requests, a crafted Echo
Request packet after a Neighbor Solicitation (NS) can trigger an Echo
Reply. The packet has to come from the same host as the NS and have a
zero as identifier to match the state created by the Neighbor Discovery
and allow replies to be generated.

# Impact:

ICMPv6 packets with identifier value of zero bypass firewall rules
written on the assumption that the incoming packets are going to create
a state in the state table.

# Note:

This advisory introduced additional issues that were addressed by
FreeBSD-EN-24:16.pf. Please refer to that erratum for additional fixes.


## Affected packages
 - **FreeBSD-kernel**
    - **Introduced:** 14.1
    - **Fixed:** 14.1_3
    - **Introduced:** 14.0
    - **Fixed:** 14.0_9
    - **Introduced:** 13.3
    - **Fixed:** 13.3_5

## Details
 - **published**: 2024-09-20T00:00:00Z
 - **modified**: 2024-09-20T00:00:00Z
 - **discovery**: 2024-08-07T00:00:00Z
 - **vid**: [f140cff0-771a-11ef-9a62-002590c1f29c](https://vuxml.freebsd.org/freebsd/f140cff0-771a-11ef-9a62-002590c1f29c.html)

## References
 - ADVISORY: [https://api.osv.dev/v1/vulns/CVE-2024-6640](https://api.osv.dev/v1/vulns/CVE-2024-6640)
 - ADVISORY: [https://www.freebsd.org/security/advisories/FreeBSD-SA-24:05.pf.asc](https://www.freebsd.org/security/advisories/FreeBSD-SA-24:05.pf.asc)
 - WEB: [https://www.freebsd.org/security/advisories/FreeBSD-EN-24:16.pf.asc](https://www.freebsd.org/security/advisories/FreeBSD-EN-24:16.pf.asc)
