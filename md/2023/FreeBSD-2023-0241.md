# FreeBSD -- Multiple vulnerabilities in OpenSSL
# Problem Description:

## X.400 address type confusion in X.509 GeneralName (CVE-2023-0286)

There is a type confusion vulnerability relating to X.400 address
processing inside an X.509 GeneralName. X.400 addresses were parsed as
an ASN1_STRING but the public structure definition for GENERAL_NAME
incorrectly specified the type of the x400Address field as ASN1_TYPE.
This field is subsequently interpreted by the OpenSSL function
GENERAL_NAME_cmp as an ASN1_TYPE rather than an ASN1_STRING.

## Timing Oracle in RSA Decryption (CVE-2022-4304)

A timing based side channel exists in the OpenSSL RSA Decryption
implementation.

## Use-after-free following BIO_new_NDEF (CVE-2023-0215)

The public API function BIO_new_NDEF is a helper function used for
streaming ASN.1 data via a BIO. It is primarily used internally to
OpenSSL to support the SMIME, CMS and PKCS7 streaming capabilities, but
may also be called directly by end user applications.

The function receives a BIO from the caller, prepends a new BIO_f_asn1
filter BIO onto the front of it to form a BIO chain, and then returns
the new head of the BIO chain to the caller. Under certain conditions,
for example if a CMS recipient public key is invalid, the new filter BIO
is freed and the function returns a NULL result indicating a failure.
However, in this case, the BIO chain is not properly cleaned up and the
BIO passed by the caller still retains internal pointers to the
previously freed filter BIO.

## Double free after calling PEM_read_bio_ex (CVE-2022-4450)

The function PEM_read_bio_ex() reads a PEM file from a BIO and parses
and decodes the \"name\" (e.g. \"CERTIFICATE\"), any header data and the
payload data. If the function succeeds then the \"name_out\", \"header\"
and \"data\" arguments are populated with pointers to buffers containing
the relevant decoded data. The caller is responsible for freeing those
buffers. It is possible to construct a PEM file that results in 0 bytes
of payload data. In this case PEM_read_bio_ex() will return a failure
code but will populate the header argument with a pointer to a buffer
that has already been freed.

# Impact:

## X.400 address type confusion in X.509 GeneralName (CVE-2023-0286)

When CRL checking is enabled (i.e. the application sets the
X509_V_FLAG_CRL_CHECK flag), this vulnerability may allow an attacker to
pass arbitrary pointers to a memcmp call, enabling them to read memory
contents or enact a denial of service. In most cases, the attack
requires the attacker to provide both the certificate chain and CRL,
neither of which need to have a valid signature. If the attacker only
controls one of these inputs, the other input must already contain an
X.400 address as a CRL distribution point, which is uncommon. As such,
this vulnerability is most likely to only affect applications which have
implemented their own functionality for retrieving CRLs over a network.

## Timing Oracle in RSA Decryption (CVE-2022-4304)

A timing based side channel exists in the OpenSSL RSA Decryption
implementation which could be sufficient to recover a plaintext across a
network in a Bleichenbacher style attack. To achieve a successful
decryption an attacker would have to be able to send a very large number
of trial messages for decryption. The vulnerability affects all RSA
padding modes: PKCS#1 v1.5, RSA-OEAP and RSASVE.

## Use-after-free following BIO_new_NDEF (CVE-2023-0215)

A use-after-free will occur under certain conditions. This will most
likely result in a crash.

## Double free after calling PEM_read_bio_ex (CVE-2022-4450)

A double free may occur. This will most likely lead to a crash. This
could be exploited by an attacker who has the ability to supply
malicious PEM files for parsing to achieve a denial of service attack.


## Affected packages
 - **FreeBSD**
    - **Introduced:** 13.1
    - **Fixed:** 13.1_7
    - **Introduced:** 12.4
    - **Fixed:** 12.4_2
    - **Introduced:** 12.3
    - **Fixed:** 12.3_12

## Details
 - **published**: 2023-08-31T00:00:00Z
 - **modified**: 2023-08-31T00:00:00Z
 - **discovery**: 2023-02-16T00:00:00Z
 - **vid**: [c8eb4c40-47bd-11ee-8e38-002590c1f29c](https://vuxml.freebsd.org/freebsd/c8eb4c40-47bd-11ee-8e38-002590c1f29c.html)

## References
 - ADVISORY: [https://api.osv.dev/v1/vulns/CVE-2023-0286](https://api.osv.dev/v1/vulns/CVE-2023-0286)
 - ADVISORY: [https://api.osv.dev/v1/vulns/CVE-2023-0215](https://api.osv.dev/v1/vulns/CVE-2023-0215)
 - ADVISORY: [https://api.osv.dev/v1/vulns/CVE-2022-4450](https://api.osv.dev/v1/vulns/CVE-2022-4450)
 - ADVISORY: [https://api.osv.dev/v1/vulns/CVE-2022-4304](https://api.osv.dev/v1/vulns/CVE-2022-4304)
 - ADVISORY: [https://www.freebsd.org/security/advisories/FreeBSD-SA-23:03.openssl.asc](https://www.freebsd.org/security/advisories/FreeBSD-SA-23:03.openssl.asc)
