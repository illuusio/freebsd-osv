# FreeBSD -- libfetch out of bounds read
# Problem Description:

The passive mode in FTP communication allows an out of boundary read
while libfetch uses strtol to parse the relevant numbers into address
bytes. It does not check if the line ends prematurely. If it does, the
for-loop condition checks for \*p == \'\\0\' one byte too late because
p++ was already performed.

# Impact:

The connection buffer size can be controlled by a malicious FTP server
because the size is increased until a newline is encountered (or no more
characters are read). This also allows to move the buffer into more
interesting areas within the address space, potentially parsing relevant
numbers for the attacker. Since these bytes become available to the
server in form of a new TCP connection to a constructed port number or
even part of the IPv6 address this is a potential information leak.


## Affected packages
 - **FreeBSD**
    - **Introduced:** 13.0
    - **Fixed:** 13.0_4
    - **Introduced:** 12.2
    - **Fixed:** 12.2_10
    - **Introduced:** 11.4
    - **Fixed:** 11.4_13

## Details
 - **published**: 2021-08-25T00:00:00Z
 - **modified**: 2021-08-25T00:00:00Z
 - **discovery**: 2021-08-24T00:00:00Z
 - **vid**: [d22b336d-0567-11ec-b69d-4062311215d5](https://vuxml.freebsd.org/freebsd/d22b336d-0567-11ec-b69d-4062311215d5.html)

## References
 - ADVISORY: [https://cveawg.mitre.org/api/cve/CVE-2021-36159](https://cveawg.mitre.org/api/cve/CVE-2021-36159)
 - ADVISORY: [https://www.freebsd.org/security/advisories/FreeBSD-SA-21:15.libfetch.asc](https://www.freebsd.org/security/advisories/FreeBSD-SA-21:15.libfetch.asc)
