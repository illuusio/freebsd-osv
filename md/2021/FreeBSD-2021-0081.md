# FreeBSD -- double free in accept_filter(9) socket configuration interface
# Problem Description:

An unprivileged process can configure an accept filter on a listening
socket. This is done using the setsockopt(2) system call. The process
supplies the name of the accept filter which is to be attached to the
socket, as well as a string containing filter-specific information.

If the filter implements the accf_create callback, the socket option
handler attempts to preserve the process-supplied argument string. A bug
in the socket option handler caused this string to be freed prematurely,
leaving a dangling pointer. Additional operations on the socket can turn
this into a double free or a use-after-free.

# Impact:

The bug may be exploited to trigger local privilege escalation or kernel
memory disclosure.


## Affected packages
 - **FreeBSD-kernel**
    - **Introduced:** 12.2
    - **Fixed:** 12.2_6

## Details
 - **published**: 2021-04-07T00:00:00Z
 - **modified**: 2021-04-07T00:00:00Z
 - **discovery**: 2021-04-06T00:00:00Z
 - **vid**: [f8e1e2a6-9791-11eb-b87a-901b0ef719ab](https://vuxml.freebsd.org/freebsd/f8e1e2a6-9791-11eb-b87a-901b0ef719ab.html)

## References
 - ADVISORY: [https://cveawg.mitre.org/api/cve/CVE-2021-29627](https://cveawg.mitre.org/api/cve/CVE-2021-29627)
 - ADVISORY: [https://www.freebsd.org/security/advisories/FreeBSD-SA-21:09.accept_filter.asc](https://www.freebsd.org/security/advisories/FreeBSD-SA-21:09.accept_filter.asc)
